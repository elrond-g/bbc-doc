# 搜索配置文档和使用方法

- [sphinx安装](# install)
- [sphinx配置文件存放路径](# conf)
- [bbc中配置sphinx](# call)

<a name="install"></a>
## 安装
### 安装sphinx
sphinx下载官网：http://sphinxsearch.com/downloads/release/

```
wget http://sphinxsearch.com/files/sphinx-2.2.10-release.tar.gz
```

### WEB服务器：安装scws
如果是多台web服务器则，每台web服务器都需要安装scws

scws下载官网：http://www.xunsearch.com/scws/download.php

####安装scws
```shell
wget http://www.xunsearch.com/scws/down/scws-1.2.2.tar.bz2
tar xvf scws-1.2.2.tar.bz2
cd scws-1.2.2
./configure --prefix=/usr/local/scws
make && make install
```
####PHP安装scws扩展(回到scws源目录中scws-1.2.2)
```shell
cd phpext/
/usr/local/webserver/php/bin/phpize
./configure --with-scws=/usr/local/scws/ --with-php-config=/usr/local/php/bin/php-config
make && make install
```
配置php.ini，在php.ini中添加如下代码
```
[scws]
extension = scws.so
scws.default.charset = utf8
;以下的的路径就是编译时的--with-scws的值
scws.default.fpath = /usr/local/scws/

```


<a name="conf"></a>
## sphinx配置文件存放路径
目录**script/sphinx/** 中存放了bbc提供的sphinx默认配置

**script/sphinx/sphinx.conf** 默认的sphinx配置文件
```
该配置文件需要sphinx服务器中有php，因为该配置文件使用php调用了conf.d文件夹中的配置
conf.d文件夹中的每个文件对应一个索引表 所有的索引配置可以单独配置对应的索引文件
```

**script/sphinx/sphinx.conf** 中需要注意一下文件的读写权限
```
可以配置为自己的log目录

log = /usr/local/var/log/searchd.log
query_log = /usr/local/var/log/query.log
pid_file = /usr/local/var/log/searchd.pid
```
**script/sphinx/conf.d/** 文件中的索引表配置文件需要注意的读写权限
```
可以配置自己的索引表文件存放目录
path = /usr/local/var/data/sysitem_item
```

**script/sphinx/sphinx_all.conf** 默认的sphinx配置文件
```
该配置文件是将不需要PHP支持，所有索引配置在同一个文件中
```

<a name="call"></a>
## bbc中配置sphinx
bbc中使用sphinx的配置放在**config/search.php**中

将**config/search.php**复制到**config/production/search.php**
```php
<?php
 /*
 |--------------------------------------------------------------------------
 | sphinx 配置
 |--------------------------------------------------------------------------
 |
 | 对应原系统: SPHINX_SERVER_HOST SPHINX_PCONNECT
 |
 */
 'sphinx' => array (
     'host' => '127.0.0.1:9306',//指定sphinx服务器的ip和端口
     'pconnect' => true,  // 是否启用sphinx持续连接
 ),

```

###配置后运营平台中开启sphinx搜索
系统－》搜索配置－》搜索引擎管理

```
查看状态，如果状态为连接异常则表示sphinx配置错误
如果显示正常则可以点击 启用 则表示正常使用了sphinx
```
系统－》搜索配置－》索引管理
```
启用了sphinx 则可以在索引管理中看到当前sphinx中有哪些索引表和对应的索引字段，对应的索引字段类型
```
